<!-- @TODO use some spa framework like vue3, react -->
<!DOCTYPE html>
<p id="plugin-main">
<h2>보고서 서버를 위한 FIGMA 툴</h2>
<p>페이지를 선택한 상태로 사용해야합니다.</p>
<p>보고서 서버를 위해 FIGMA 툴을 사용하여 json파일을 생성합니다.</p>
    <p id="xy-viewer"></p>
<div>
    <p id="widthHeight-viewer"></p>
</div>
<div>
    <p id="color-viewer"></p>
</div>

<button id="export-pdf">export pdf</button>
<button id="export-json">export json</button>

<div id="json-viewer">viewer</div>
<div id="sample-dataMapper">Sample Template</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@textea/json-viewer@3"></script>

<script>


onmessage = (event) => {
  if (event.data.pluginMessage?.pluginMessage?.type){
    switch (event.data.pluginMessage.pluginMessage.type) {
      case 'render-pdfObjects':
        new JsonViewer({
          value: event.data.pluginMessage.pluginMessage.data,
        }).render('#json-viewer')
        break;

        case 'render-dataMapper':
            new JsonViewer({
                value: event.data.pluginMessage.pluginMessage.data,
            }).render('#sample-dataMapper')
            break;

        case 'selection-change':
            new JsonViewer({
                value: event.data.pluginMessage.pluginMessage.data.xy,
            }).render('#xy-viewer')

            new JsonViewer({
                value: event.data.pluginMessage.pluginMessage.data.widthHeight,
            }).render('#widthHeight-viewer')

            new JsonViewer({
                value: event.data.pluginMessage.pluginMessage.data.color,
            }).render('#color-viewer')

            break;



      case 'download-pdf':
        data = event.data.pluginMessage.pluginMessage.data.bytes;
        
        // download
        var blob = new Blob([data], { type: 'application/pdf' });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = event.data.pluginMessage.pluginMessage.data.name  + '.pdf';
        a.click();
        break;

    }
  }
}

document.getElementById('export-pdf').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'export-pdf' } }, '*')
}

</script>
</html>